<?xml version="1.0"?>
<project name="ACLib" default="compile">
	<property name="private.buildfile" value="build-resources/private/user-antbuild.properties"/>
	<property file="${private.buildfile}"/>
	<property file="build-resources/antbuild.properties"/>
	<property name="version.file" value="aclib-version.txt"/>
	<property name="version.file.dev" value="version/${version.file}"/>
	<fail message="No Software Directory specified, a private build file should exist in ${private.buildfile} this should specify at the very least 'software.dir'">
		<condition>
			<not>
					<isset property="software.dir"/>
			</not>
		</condition>
	</fail>
	<path id="compile.classpath">
		<fileset dir="lib" id="lib">
			<include name="*.jar"/>
			<exclude name="*sources.jar"/>
		</fileset>
		<fileset dir="${software.dir}/fastrf/" id="fastrf">
			<include name="fastrf.jar"/>
		</fileset>
	</path>	
	<target name="init"> 
		<mkdir dir="build/classes/"/>
		<mkdir dir="dist"/>
		<mkdir dir="models"/>
	</target>
	
	<target name="clean">
		<delete dir="build"/>
		<delete dir="dist"/>
		<delete dir="doc"/>
	</target>
	<target name="compile" depends="init,doc">
		<javac srcdir="src" destdir="build/classes" debug="true">
		<classpath refid="compile.classpath"/>
		</javac>
	</target>
	<target name="doc">
		<javadoc sourcepath="src/" author="true" destdir="doc/" classpathref="compile.classpath">
	    <!--doctitle><![CDATA[<h1>Test</h1>]]></doctitle>
	    <bottom><![CDATA[<i>Copyright &#169; 2000 Dummy Corp. All Rights Reserved.</i>]]></bottom>-->
		</javadoc>
	</target>
	<target name="archive" depends="compile">
		<buildnumber file="/ubc/cs/project/arrow/seramage/software/build-numbers/buildnumber-${ant.project.name}"/>
		<property name="version.string" value="v${version.major}.${version.minor}.${version.revision}${version.beta}-${build.number}"/>
		<property name="version.devstring" value="v${version.major}.${version.minor}.${version.revision}dev-${build.number}"/>
		<echo file="${version.file.dev}">${version.devstring}</echo>
		<echo file="build/classes/${version.file}">${version.string}</echo>
		
		
		<!--<jar destfile="dist/aclib-v${version.major}_${version.minor}_${build.number}.jar" basedir="build/classes"/>-->
		<jar destfile="dist/aclib.jar" basedir="build/classes"/>
		<jar destfile="dist/aclib-src.jar">
					<fileset dir="src/">
						 <include name="**/*.java"/>
					</fileset>
		</jar>
		<copy todir="dist/" force="true">
			<fileset refid="lib"/>
			<fileset refid="fastrf"/>	
		</copy>
		
	</target>			
	<target name="deploy" depends="archive">
		<mkdir dir="${deploy.dir}"/>
		<chmod perm="666">
						<fileset dir="${deploy.dir}">
								<include name="*"/>
						</fileset>
				</chmod>
		
		<copy todir="${deploy.dir}" force="true">
			<fileset dir="dist/">
				<include name="*"/>
			</fileset>
		</copy>
		<chmod perm="444">
				<fileset dir="${deploy.dir}">
						<include name="*"/>
				</fileset>
		</chmod>
		<chmod perm="555">
				<fileset dir="${deploy.dir}">
						<include name="*.sh"/>
				</fileset>
		</chmod>
	</target>
</project>
